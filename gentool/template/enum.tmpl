{{/* gotype: github.com/woocoos/kocli/gentool.EnumInput */}}

{{ define "enum" }}
package types

// Code generated by:  kocli gen enum -b {{.BaseType}} -n {{.EnumName}} -v{{" "}}
{{- range $index, $value := .InputValues }}{{ if $index }},{{ end }}{{ $value }}{{ end }}

{{ $TypeName := pascal .EnumName  }}
{{- $Values := .Values }}
{{- $Names := .Names }}
// {{ $TypeName }} enum definition
type {{ $TypeName }} {{ .BaseType }}

const (
{{- range $index, $value := .Names }}
	{{ $TypeName }}{{ pascal $value }} {{ $TypeName }} = {{ index $Values $index }}
{{- end }}
)

// String returns the readable string representation of the {{ $TypeName }}.
func (e {{ $TypeName }}) String() string {
    {{- if and (eq .BaseType "string") (not .IsNamedValues) }}
        return string(e)
    {{- else }}
    switch e {
    {{- range $index, $value := .Names }}
    case {{ $TypeName }}{{ pascal $value }}:
        return {{ quote $value }}
    {{- end }}
    default:
        return "Unknown"
    }
    {{- end }}
}

// Values implements ent EnumValues interface
func (e {{ $TypeName }}) Values() []string {
	return []string{
{{- range $index, $value := .Names }}
		{{ $TypeName }}{{ pascal $value }}.String(),
{{- end }}
	}
}

// MarshalGQL implements graphql.Marshaler.
func (e {{ $TypeName }}) MarshalGQL(w io.Writer) {
	io.WriteString(w, strconv.Quote(e.String()))
}

// UnmarshalGQL implements graphql.Unmarshaler.
func (e *{{ $TypeName }}) UnmarshalGQL(v any) error {
	str, ok := v.(string)
	if !ok {
		return fmt.Errorf("enum {{$TypeName}} must be strings,but %v",v)
	}
{{- if eq .BaseType "int" }}
	switch str {
{{- range $index, $value := .Names }}
	case "{{ $value }}":
		*e = {{ $TypeName }}{{ pascal $value }}
{{- end }}
	default:
		return fmt.Errorf("%q is not a valid {{ $TypeName }}", str)
	}
	return nil
{{- else if eq .BaseType "string" }}
    tv := {{ $TypeName }}(str)
    if err := {{ $TypeName }}Validator(*e); err != nil{
        return err
    }
    *e = tv
    return nil
{{- end }}
}

// {{ $TypeName }}Validator validates {{ $TypeName }} enum value
func {{ $TypeName }}Validator(et {{ $TypeName }}) error {
	switch et {
	case {{ range $index, $value := .Names }}{{ if $index }},{{ end }}{{ $TypeName }}{{ pascal $value }}{{ end }}:
		return nil
	default:
		return fmt.Errorf("invalid enum value for {{ $TypeName }} field: %q", et)
	}
}

// Value implements driver.Valuer
func (e {{ $TypeName }}) Value() (driver.Value, error) {
    {{- if eq .BaseType "int" }}
        return int64(e), nil
    {{- else if eq .BaseType "string" }}
        return string(e), nil
    {{- end }}
}

// Scan implements sql.Scanner
func (e *{{ $TypeName }}) Scan(value any) error {
    switch v := value.(type) {
    case nil:
        return nil
    {{- if eq .BaseType "int" }}
    case {{.BaseType}}:
        *e = {{ $TypeName }}(v)
    case int64:
        *e = {{ $TypeName }}(v)
    {{- else if eq .BaseType "string" }}
    case string:
        *e = {{ $TypeName }}(v)
    case []byte:
        *e = {{ $TypeName }}(string(v))
    {{- end }}
    default:
        return fmt.Errorf("unsupported type for %s: %T", "{{ $TypeName }}", value)
    }
    return nil
}
{{ end }}